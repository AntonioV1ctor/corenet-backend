(ns corenet-backend.services.postCreate
  (:require [datomic.api :as d]))

(def db-uri "datomic:dev://localhost:4334/corenet")

(d/create-database db-uri)

(def schema
  [{:db/ident       :post/titulo
    :db/valueType   :db.type/string
    :db/doc         "titulo da postagem"}
 
    {:db/ident      :post/conteudo
    :db/valueType   :db.type/string
    :db/doc         "conteudo da postagem"}])



(defn createPost [titulo conteudo]
  (d/transact conn schema)
  (try
    [(d/transact conn [{:post/titulo titulo} {:post/conteudo conteudo}])
     {:status 200
          :headers {"Content-Type" "application/json"}
          :body (generate-string
                  {:msg "Postagem realizada com sucesso!"
                   :titulo titulo
                   :conteudo conteudo})}]
    (catch Exception e 
    {:status 400
         :headers {"Content-Type" "application/json"}
         :body (generate-string {:msg "Ocorreu um erro ao salvar o título e o conteúdo no banco de dados. Tente novamente!"})})))
  
  
